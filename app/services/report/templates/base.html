<!-- app/service/report/templates/base.html -->
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>{{ report.company.cmp_nm }} ESG Report</title>

  <style>
    /* 로컬 TTF만 사용 (외부 링크 절대 금지) */
    @font-face {
      font-family: "KRBody";
      src: url("/app/static/fonts/KRBody-Regular.ttf") format("truetype");
      font-weight: normal; /* 400 대신 normal */
      font-style: normal; /* 권장 */
    }
    @font-face {
      font-family: "KRBodyBold";
      src: url("/app/static/fonts/KRBody-Bold.ttf") format("truetype");
      font-weight: bold;   /* 700 대신 bold */
      font-style: normal; /* 권장 */
    }

    html, body {
      font-family: "KRBody";
      font-size: 14px;
      line-height: 1.45;
    }

    h1, h2, strong {
      font-family: "KRBodyBold";
      margin: 0 0 8px;
    }
    h1 { font-size: 28px; font-weight: bold; }
    h2 { font-size: 18px; font-weight: bold; }

    .cover { display:flex; height:88vh; align-items:center; }
    .muted { color:#666; font-size:12px }
    .card { border:1px solid #ddd; border-radius:8px; padding:12px; margin:6px 0 }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .page-break { page-break-before: always; }
    .footer { font-size:10px; color:#888; text-align:center; margin-top:12px; }
    .summary-empty { border:1px dashed #bbb; border-radius:8px; padding:16px; color:#555; background:#fafafa; }

    .card table { width:100%; border-collapse:collapse; font-size:12px }
    .card table th, .card table td { border:1px solid #ddd; padding:6px; text-align:left }
    h3 { margin:6px 0 6px; font-size:16px; font-weight:bold; }

  </style>
</head>

<body>

<!-- 표지 -->
<section class="cover">
  <div>
    <h1>{{ report.company.cmp_nm }} — ESG Report</h1>
    <div class="muted">
      기간: {{ report.period_label }}<br/>
      생성일: {{ report.generated_at }}
    </div>
  </div>
</section>

<div class="page-break"></div>

<!-- 요약 카드 (1페이지) -->
<section>
  <h2>Executive Summary</h2>

  {# summary가 비었을 때도 메시지 표시 #}
  {% if report.summary and report.summary|length > 0 %}
    <div class="grid">
      {% for k, v in report.summary.items() %}
        <div class="card">
          <strong>{{ k }}</strong><br/>
          {# 값이 dict/list여도 대충 보이도록 간단 처리 #}
          {% if v is mapping %}
            <pre style="margin:6px 0 0; white-space:pre-wrap">{{ v | tojson(indent=0) }}</pre>
          {% elif v is sequence and v is not string %}
            <pre style="margin:6px 0 0; white-space:pre-wrap">{{ v | tojson(indent=0) }}</pre>
          {% else %}
            {{ v }}
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="summary-empty">
      요약 지표를 표시할 데이터가 없습니다. 데이터 처리 파이프라인 또는 기간 선택을 확인해 주세요.
    </div>
  {% endif %}
</section>

<div class="page-break"></div>

<!-- 환경(2p) -->
{{ env_html|safe }}

<div class="page-break"></div>

<!-- 사회(2p) -->
{{ soc_html|safe }}

<div class="page-break"></div>

<!-- 거버넌스(2p) -->
{{ gov_html|safe }}

<footer class="footer">
  <div>© {{ report.company.cmp_nm }} — Confidential</div>
</footer>
</body>
</html>
